{% extends "layout_template.html" %}

{% import 'macros.html' as macros %}

{% block title %} Results{% endblock title %}

{% block head %}
	{{ super() }}
	<link rel="stylesheet" href="/static/style/hra.css"/>
	<meta name="csrf-token" content="{{ csrf_token() }}">
	<script type=text/javascript>
    	var section_scores = {{ results['section_scores']|safe }};
	</script>
{% endblock head %}

{% block header %}
	<div id="scorecard_navbar" class="container-fluid navbar-fixed-top hra_results_navbar">
		{{ super() }}
		<span id="hra_results_title"> {{ account }} Aggregate Results</span>
		<div class="tc-heading">
			<span class="signup-btn btn btn-sm btn-default" id="export_pdf">
				<a href="#" onclick="export_to_pdf()">Export PDF</a>
			</span>
			<span class="signup-btn btn btn-sm btn-default" id="hra-logout">
				<a href="/logout">Log Out</a>
			</span>
		</div>
	</div>
{% endblock header %}
{% block messages %}{% endblock messages %}

{% block content %}
	<div class="container">
		<div id="nav_bar_spacer"></div>
		<div id="overall_score_title" class="graph_title">Your Overall Score</div>
		<div id="donutDiv" class="centered chart_container">
			<div id="overall_score"></div>
			<canvas id="scoreDonutChart" width="100%" height="100%"></canvas>
		</div>
		<div class="graph_title">
			<span class="title_text">Section Breakdown</span>
			<div id="chart_legend">
				<div class="legend_key" id="user_score_key"></div>
				<div class="legend_label" id="user_score_label">Your Score</div>
				<div class="legend_key" id="tc_score_key"></div>
				<div class="legend_label" id="tc_score_label">National Average</div>
			</div>
		</div>
		<div id="barDiv" class="centered chart_container">
			<canvas id="scoreBarChart" width="100%" height="100%"></canvas>
		</div>	
    </div>
    
    <div id="questionnaireBreakdownContainer" class="container">
	    <div class="graph_title title_text">Questionnaire Breakdown</div>
	    {% set blurb = "" %}
	    {% set headercounter = 0 %}
		{% set answer_count = results['answer_counts'] %}
	    {% for question in hra_questions %}
			{% set question_loop = loop.index - headercounter %}
				
			{% if question.type == "GRID" %}
			{% set table_width = question.answers|length %}
					<tr>
						<td class='grid_column'>{{ question.text }}</td>
						{% for i in range(0, table_width) %}
							<td class="grid_cell"><span class="grid_answer">{{ answer_count[question.qid][(i+1)|string]|default("0%") }}</span></td>
						{% endfor %}
					</tr>
			
				{% if question.last_row %}
			</table>
				</div>
					{% if blurb != "" %}
				<div class="question_blurb_container panel-footer">
					{{ blurb }}
				</div>
					{% endif %}
			</div>
				{% endif %}
			
			{% elif question.type == "GRID_TEXT"%}
				</table>
				<span class="grid_text_question">{{ question.text }}</span>
				<input type="textarea" class="grid_answer grid_text_answer" name="{{ question.qid }}" {# value="{{  }}" #} disabled>
				</div>
					{% if blurb != "" %}
				<div class="question_blurb_container panel-footer">
					{{ blurb }}
				</div>
					{% endif %}
			</div>
			{% else %}
			
			{% if question_loop == 3 %}
				<div id="Tobacco" class="section_title">Tobacco Section</div>
			{% elif question_loop == 6 %}
				<div id="Diet&Nutrition" class="section_title">Diet & Nutrition Section</div>
			{% elif question_loop == 16 %}
				<div id="PhysicalActivity" class="section_title">Physical Activity Section</div>
			{% elif question_loop == 19 %}
				<div id="Stress" class="section_title">Stress Section</div>
			{% elif question_loop == 22 %}
				<div id="MedicationManagement" class="section_title">Medication Management Section</div>
			{% elif question_loop == 27 %}
				<div id="PreventativeCare" class="section_title">Screening & Preventative Care Section</div>
			{% elif question_loop == 40 %}
				<div id="ChronicConditions" class="section_title">Chronic Conditions Section</div>
			{% elif question_loop == 65 %}
				<div id="SelfAnalysis" class="section_title">Self-Analysis Section</div>
			{% endif %}
			
			<div class="panel panel-default {{ question_loop }}">
				{% if question.text == "Age" %}
					<div class="panel-heading question-text">{# {{ question_loop }}. #}Average Age</div>
				{% else %}
					<div class="panel-heading question-text">{# {{ question_loop }}. #}{{ question.text|safe }}</div>
				{% endif %}
				<div class="panel-body mc_answer_area">
					{% if question.type == "MULTIPLE_CHOICE" %}
						{% for answer in question.answers %}
							{# {% if answer.value != None %}
								<span class="mc_grade">{{ answer.value|first }}</span>
							{% endif %} #}
							{% set a = answer_count[question.qid][answer.aid]|default("0%") %}
							<span class="mc_grade">{{ a }}</span>
							{% if a|length == 2 %}
								<span>&nbsp;</span>
							{% endif %}
							<span>&nbsp;</span>
							<span name="{{ question.qid }}" class="mc_text">{{ answer.text|safe }}</span>
							<br>
						{% endfor %}
				</div>
						{% if question.blurb %}
				<div class="question_blurb_container panel-footer">
					{{ question.blurb }}
				</div>
						{% endif %}
			</div>
					{% elif question.type == "INTEGER" %}
						<input class="input_number mc_grade" type="number" value="{{ answer_count[question.qid]|int }}" disabled>
				</div>
						{% if question.blurb %}
				<div class="question_blurb_container panel-footer">
					{{ question.blurb }}
				</div>
						{% endif %}
			</div>
					{% elif question.type == "GRID_HEADER" %}
						{% set blurb = question.blurb %}
						{% set headercounter = headercounter + 1 %}
						{% set table_width = question.columns|length %}
						<table class="table table-bordered table-striped table-hover question_grid">
							<tr> <td></td>{# <!-- Table Header and blank first column --> #}
							{% for column in question.columns %}
							{% set column_loop = loop.index %}
							{% set a = hra_questions[question_loop+headercounter+1]['answers'][column_loop-1]['value'] %}
								<td class="grid_cell grid_column">
									{# {% if a != None %}
										<span class="grid_answer">{{ a }}</span><br>
									{% else %}
										<br>
									{% endif %} #}
									<span>{{ column }}</span>
								</td>
							{% endfor %}
							</tr>
							
					{% endif %}
			{% endif %}
		{% endfor %}
	    
    </div>
    <br>
    <br>
    <br>
    <span id="top-link-block" class="hidden well well-sm">
	    <i class="glyphicon glyphicon-chevron-up"></i> Back to Top
	</span><!-- /top-link-block -->
</div>
	
{% endblock content %}

{% block footer %}{% endblock footer %}
{% block script_section %}
	<script src="../static/libs/Chart.js/src/Chart.Core.js"></script>
	<script src="../static/libs/Chart.js/src/Chart.Bar.js"></script>
	<script src="../static/libs/Chart.js/src/Chart.Doughnut.js"></script>
	<script src="../static/js/employer_scorecard.js"></script>
{% endblock script_section %}